<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ATC4_HQ.ViewModels"
             xmlns:models="clr-namespace:ATC4_HQ.Models"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ATC4_HQ.Views.DownloadMonitorView"
             x:DataType="vm:DownloadMonitorViewModel">

  <Design.DataContext>
    <vm:DownloadMonitorViewModel/>
  </Design.DataContext>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- æ ‡é¢˜æ  -->
    <Border Grid.Row="0" Background="#FF2D2D30" Padding="15,10">
      <StackPanel Orientation="Horizontal" Spacing="20">
        <TextBlock Text="ðŸ“¥ BTä¸‹è½½ç›‘è§†å™¨" FontSize="18" FontWeight="Bold" Foreground="White"/>
        <TextBlock Text="{Binding TotalSpeed}" FontSize="14" Foreground="#FF00FF00" VerticalAlignment="Center"/>
      </StackPanel>
    </Border>

    <!-- æ€»ä½“è¿›åº¦æ¡ -->
    <Border Grid.Row="1" Background="#FF3C3C3C" Padding="15,10">
      <StackPanel Spacing="10">
        <TextBlock Text="æ€»ä½“è¿›åº¦" FontSize="12" Foreground="White"/>
        <ProgressBar Value="{Binding TotalProgress}" Maximum="100" Height="20" 
                     Background="#FF1E1E1E" Foreground="#FF007ACC"/>
        <TextBlock Text="{Binding TotalProgress, StringFormat={}{0:F1}%}" 
                   FontSize="12" Foreground="White" HorizontalAlignment="Center"/>
      </StackPanel>
    </Border>

    <!-- ä¸‹è½½åˆ—è¡¨ -->
    <DataGrid Grid.Row="2" 
              ItemsSource="{Binding DownloadItems}"
              SelectedItem="{Binding SelectedDownloadItem}"
              AutoGenerateColumns="False"
              CanUserReorderColumns="True"
              CanUserResizeColumns="True"
              CanUserSortColumns="True"
              GridLinesVisibility="Horizontal"
              HorizontalGridLinesBrush="#FF404040"
              Background="#FF252526"
              Foreground="White"
              RowBackground="#FF2D2D30"
              HeadersVisibility="Column">
      
      <DataGrid.Columns>
        <DataGridTemplateColumn Header="çŠ¶æ€" Width="80">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" Spacing="5" HorizontalAlignment="Center">
                <TextBlock Text="â¸ï¸" FontSize="12" IsVisible="{Binding !IsDownloading, FallbackValue=False}"/>
                <TextBlock Text="â–¶ï¸" FontSize="12" IsVisible="{Binding IsDownloading, FallbackValue=False}"/>
                <TextBlock Text="âœ…" FontSize="12" IsVisible="{Binding IsCompleted, FallbackValue=False}"/>
                <TextBlock Text="âŒ" FontSize="12" IsVisible="{Binding Status, Converter={x:Static StringConverters.IsNotNullOrEmpty}, FallbackValue=False}"/>
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTextColumn Header="åç§°" Binding="{Binding Name}" Width="200"/>
        
        <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding Status}" Width="100"/>
        
        <DataGridTemplateColumn Header="è¿›åº¦" Width="150">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Spacing="5">
                <ProgressBar Value="{Binding Progress}" Maximum="100" Height="15"
                             Background="#FF1E1E1E" Foreground="#FF007ACC"/>
                <TextBlock Text="{Binding Progress, StringFormat={}{0:F1}%}" 
                           FontSize="10" HorizontalAlignment="Center"/>
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTextColumn Header="å¤§å°" Binding="{Binding FormattedSize}" Width="120"/>
        
        <DataGridTextColumn Header="é€Ÿåº¦" Binding="{Binding FormattedSpeed}" Width="100"/>
        
        <DataGridTextColumn Header="ç£åŠ›é“¾æŽ¥" Binding="{Binding MagnetLink}" Width="300"/>
      </DataGrid.Columns>
    </DataGrid>

    <!-- æŽ§åˆ¶æŒ‰é’®æ  -->
    <Border Grid.Row="3" Background="#FF2D2D30" Padding="15,10">
      <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
        
        <!-- å…¨éƒ¨æŽ§åˆ¶æŒ‰é’® -->
        <StackPanel Orientation="Horizontal" Spacing="5">
          <Button Content="â–¶ï¸ å…¨éƒ¨å¼€å§‹" Command="{Binding StartAllCommand}" 
                  Background="#FF007ACC" Foreground="White" Padding="10,5"/>
          <Button Content="â¸ï¸ å…¨éƒ¨æš‚åœ" Command="{Binding PauseAllCommand}" 
                  Background="#FF8B4513" Foreground="White" Padding="10,5"/>
          <Button Content="ðŸ—‘ï¸ æ¸…ç†å®Œæˆ" Command="{Binding RemoveCompletedCommand}" 
                  Background="#FFDC143C" Foreground="White" Padding="10,5"/>
        </StackPanel>

        <Separator Width="20" Background="#FF404040"/>

        <!-- é€‰ä¸­é¡¹æŽ§åˆ¶æŒ‰é’® -->
        <StackPanel Orientation="Horizontal" Spacing="5">
          <Button Content="â–¶ï¸ å¼€å§‹" Command="{Binding StartSelectedCommand}" 
                  Background="#FF228B22" Foreground="White" Padding="10,5"/>
          <Button Content="â¸ï¸ æš‚åœ" Command="{Binding PauseSelectedCommand}" 
                  Background="#FF8B4513" Foreground="White" Padding="10,5"/>
          <Button Content="ðŸ—‘ï¸ åˆ é™¤" Command="{Binding RemoveSelectedCommand}" 
                  Background="#FFDC143C" Foreground="White" Padding="10,5"/>
        </StackPanel>

        <Separator Width="20" Background="#FF404040"/>

        <!-- å…¶ä»–æŒ‰é’® -->
        <Button Content="âž• æ·»åŠ ä¸‹è½½" Command="{Binding AddDownloadCommand}" 
                Background="#FF4169E1" Foreground="White" Padding="10,5"/>
      </StackPanel>
    </Border>
  </Grid>
</UserControl>
